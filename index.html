<!DOCTYPE html>
<html lang="et">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#451a03">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Niiluse Teekond - Vana-Egiptuse ÃµppimismÃ¤ng</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
  <style>
    :root {
      --egypt-gold: #fbbf24;
      --egypt-sand: #fef3c7;
      --egypt-lapis: #1e3a8a;
      --egypt-brown: #451a03;
    }

    * {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      font-family: 'Outfit', sans-serif;
    }

    body {
      overscroll-behavior-y: none;
      user-select: none;
      -webkit-user-select: none;
      background-color: var(--egypt-brown);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    input {
      user-select: text;
      -webkit-user-select: text;
    }

    .glass {
      background: rgba(69, 26, 3, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(251, 191, 36, 0.2);
    }

    .glass-light {
      background: rgba(254, 243, 199, 0.9);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(251, 191, 36, 0.3);
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px) rotate(0deg);
      }

      50% {
        transform: translateY(-15px) rotate(2deg);
      }
    }

    .animate-float {
      animation: float 4s ease-in-out infinite;
    }

    @keyframes sand-shimmer {
      from {
        background-position: 0 0;
      }

      to {
        background-position: 100px 100px;
      }
    }

    .bg-sand {
      background-image: radial-gradient(circle, #fbbf24 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.05;
      animation: sand-shimmer 20s linear infinite;
    }

    .btn-egypt {
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 0 #b45309;
    }

    .btn-egypt:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #b45309;
    }

    .achievement-card {
      transition: all 0.5s ease;
    }

    .bg-cream-paper {
      background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
    }

    .bg-sandpaper {
      background-image: url('https://www.transparenttextures.com/patterns/sandpaper.png');
    }

    .achievement-card.unlocked {
      animation: unlock-shine 2s linear infinite;
    }

    @keyframes unlock-shine {
      0% {
        box-shadow: 0 0 5px #fbbf24;
      }

      50% {
        box-shadow: 0 0 15px #fbbf24;
      }

      100% {
        box-shadow: 0 0 5px #fbbf24;
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ========== HELIEFEKTID ==========
    const useSounds = () => {
      const synthRef = useRef(null);
      const [soundEnabled, setSoundEnabled] = useState(true);
      const [initialized, setInitialized] = useState(false);

      const initAudio = async () => {
        if (initialized) return;
        await Tone.start();
        synthRef.current = {
          correct: new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.3 } }).toDestination(),
          wrong: new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.3, sustain: 0.1, release: 0.5 } }).toDestination(),
          treasure: new Tone.PolySynth(Tone.Synth, { oscillator: { type: 'sine' }, envelope: { attack: 0.02, decay: 0.3, sustain: 0.2, release: 0.5 } }).toDestination(),
          click: new Tone.MembraneSynth({ pitchDecay: 0.05, octaves: 2, envelope: { attack: 0.001, decay: 0.1, sustain: 0, release: 0.1 } }).toDestination(),
          fanfare: new Tone.PolySynth(Tone.Synth).toDestination(),
          fall: new Tone.Synth({ oscillator: { type: 'sawtooth' }, envelope: { attack: 0.01, decay: 0.5, sustain: 0.2, release: 0.8 } }).toDestination(),
          event: new Tone.PolySynth(Tone.Synth, { oscillator: { type: 'triangle' }, envelope: { attack: 0.05, decay: 0.2, sustain: 0.3, release: 0.4 } }).toDestination()
        };
        setInitialized(true);
      };

      const playSound = useCallback((type) => {
        if (!soundEnabled || !synthRef.current) return;
        const now = Tone.now();
        try {
          switch (type) {
            case 'correct':
              synthRef.current.correct.triggerAttackRelease('C5', '8n', now);
              synthRef.current.correct.triggerAttackRelease('E5', '8n', now + 0.1);
              synthRef.current.correct.triggerAttackRelease('G5', '8n', now + 0.2);
              break;
            case 'wrong':
              synthRef.current.wrong.triggerAttackRelease('C3', '4n', now);
              break;
            case 'treasure':
              synthRef.current.treasure.triggerAttackRelease(['C5', 'E5', 'G5', 'C6'], '4n', now);
              break;
            case 'click':
              synthRef.current.click.triggerAttackRelease('C2', '32n', now);
              break;
            case 'streak':
              synthRef.current.fanfare.triggerAttackRelease(['C4', 'E4', 'G4'], '8n', now);
              synthRef.current.fanfare.triggerAttackRelease(['E4', 'G4', 'B4'], '8n', now + 0.3);
              break;
            case 'victory':
              synthRef.current.fanfare.triggerAttackRelease(['C4', 'E4', 'G4'], '8n', now);
              synthRef.current.fanfare.triggerAttackRelease(['G4', 'C5', 'E5'], '8n', now + 0.4);
              synthRef.current.fanfare.triggerAttackRelease(['C5', 'E5', 'G5'], '2n', now + 0.6);
              break;
            case 'fall':
              synthRef.current.fall.triggerAttackRelease('C4', '8n', now);
              synthRef.current.fall.triggerAttackRelease('A3', '8n', now + 0.15);
              synthRef.current.fall.triggerAttackRelease('F3', '8n', now + 0.3);
              break;
            case 'levelup':
              synthRef.current.correct.triggerAttackRelease('G4', '16n', now);
              synthRef.current.correct.triggerAttackRelease('C5', '16n', now + 0.1);
              synthRef.current.correct.triggerAttackRelease('E5', '16n', now + 0.2);
              synthRef.current.correct.triggerAttackRelease('G5', '8n', now + 0.3);
              break;
            case 'event':
              synthRef.current.event.triggerAttackRelease(['E4', 'G4', 'B4'], '8n', now);
              synthRef.current.event.triggerAttackRelease(['G4', 'B4', 'D5'], '4n', now + 0.2);
              break;
            case 'achievement':
              synthRef.current.fanfare.triggerAttackRelease(['C5', 'E5'], '16n', now);
              synthRef.current.fanfare.triggerAttackRelease(['G5', 'C6'], '8n', now + 0.2);
              break;
          }
        } catch (e) { console.log('Sound error:', e); }
      }, [soundEnabled]);

      return { playSound, soundEnabled, setSoundEnabled, initAudio, initialized };
    };

    // ========== PILDID ==========
    const images = {
      nile: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/fe/Nile_composite_NASA.jpg/200px-Nile_composite_NASA.jpg", emoji: "ğŸŒŠ" },
      delta: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Nile_River_and_delta_from_orbit.jpg/200px-Nile_River_and_delta_from_orbit.jpg", emoji: "ğŸ”º" },
      egypt_map: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Egypt_Topography.png/200px-Egypt_Topography.png", emoji: "ğŸ—ºï¸" },
      giza: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Kheops-Pyramid.jpg/280px-Kheops-Pyramid.jpg", emoji: "ğŸ”º" },
      sphinx: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Great_Sphinx_of_Giza_-_20080716a.jpg/250px-Great_Sphinx_of_Giza_-_20080716a.jpg", emoji: "ğŸ¦" },
      step_pyramid: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Saqqara_BW_5.jpg/280px-Saqqara_BW_5.jpg", emoji: "ğŸ“" },
      karnak: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Karnak_Tempel_01.jpg/280px-Karnak_Tempel_01.jpg", emoji: "ğŸ›ï¸" },
      luxor: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Luxor_Temple_R01.jpg/250px-Luxor_Temple_R01.jpg", emoji: "ğŸ›ï¸" },
      abu_simbel: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Abu_Simbel%2C_front%2C_Egypt%2C_Oct_2004.jpg/280px-Abu_Simbel%2C_front%2C_Egypt%2C_Oct_2004.jpg", emoji: "ğŸ—¿" },
      tutankhamun: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Tutanchamun_Maske.jpg/200px-Tutanchamun_Maske.jpg", emoji: "ğŸ‘‘" },
      ramses_ii: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Ramesses_II_in_the_Turin_Museum24.jpg/180px-Ramesses_II_in_the_Turin_Museum24.jpg", emoji: "ğŸ—¿" },
      nefertiti: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1f/Nofretete_Neues_Museum.jpg/180px-Nofretete_Neues_Museum.jpg", emoji: "ğŸ‘¸" },
      hatshepsut: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Hatshepsut.jpg/180px-Hatshepsut.jpg", emoji: "ğŸ‘‘" },
      akhenaten: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Pharaoh_Akhenaten.jpg/180px-Pharaoh_Akhenaten.jpg", emoji: "â˜€ï¸" },
      cleopatra: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Kleopatra-VII.-Altes-Museum-Berlin1.jpg/180px-Kleopatra-VII.-Altes-Museum-Berlin1.jpg", emoji: "ğŸ" },
      narmer: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Narmer_Palette.jpg/180px-Narmer_Palette.jpg", emoji: "âš”ï¸" },
      anubis: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Anubis_standing.svg/150px-Anubis_standing.svg.png", emoji: "ğŸº" },
      horus: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/Horus_standing.svg/150px-Horus_standing.svg.png", emoji: "ğŸ¦…" },
      osiris: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Standing_Osiris_edit1.svg/120px-Standing_Osiris_edit1.svg.png", emoji: "ğŸ’€" },
      isis: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Isis.svg/150px-Isis.svg.png", emoji: "ğŸŒ™" },
      ra: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Re-Horakhty.svg/150px-Re-Horakhty.svg.png", emoji: "â˜€ï¸" },
      bastet: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/Bastet.svg/150px-Bastet.svg.png", emoji: "ğŸ±" },
      thoth: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Thoth.svg/150px-Thoth.svg.png", emoji: "ğŸ¦¢" },
      seth: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Set.svg/150px-Set.svg.png", emoji: "ğŸŒªï¸" },
      maat: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Maat.svg/150px-Maat.svg.png", emoji: "ğŸª¶" },
      mummy: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Mummy_Louvre.jpg/150px-Mummy_Louvre.jpg", emoji: "ğŸ§Ÿ" },
      sarcophagus: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Tutankhamun_sarcophagus.jpg/200px-Tutankhamun_sarcophagus.jpg", emoji: "âš°ï¸" },
      canopic_jars: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Canopic_jars_of_Neskhons.jpg/200px-Canopic_jars_of_Neskhons.jpg", emoji: "ğŸº" },
      valley_kings: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/ValleyKings.jpg/250px-ValleyKings.jpg", emoji: "ğŸœï¸" },
      book_dead: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/BD_Hunefer.jpg/280px-BD_Hunefer.jpg", emoji: "ğŸ“œ" },
      weighing_heart: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/BD_Weighing_of_the_Heart.jpg/280px-BD_Weighing_of_the_Heart.jpg", emoji: "âš–ï¸" },
      rosetta: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Rosetta_Stone.JPG/180px-Rosetta_Stone.JPG", emoji: "ğŸª¨" },
      hieroglyphs: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Hieroglyphs_from_the_tomb_of_Seti_I.jpg/250px-Hieroglyphs_from_the_tomb_of_Seti_I.jpg", emoji: "ğ“€€" },
      scribe: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Egypte_louvre_001.JPG/180px-Egypte_louvre_001.JPG", emoji: "âœï¸" },
      scarab: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Lapis.lazuli.scarab.800pix.060203.jpg/200px-Lapis.lazuli.scarab.800pix.060203.jpg", emoji: "ğŸª²" },
      workers: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Maler_der_Grabkammer_des_Menna_004.jpg/250px-Maler_der_Grabkammer_des_Menna_004.jpg", emoji: "ğŸ‘·" },
      farmers: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Maler_der_Grabkammer_des_Sennedjem_001.jpg/250px-Maler_der_Grabkammer_des_Sennedjem_001.jpg", emoji: "ğŸŒ¾" },
      alexander: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Alexander_the_Great_mosaic.jpg/200px-Alexander_the_Great_mosaic.jpg", emoji: "âš”ï¸" },
      howard_carter: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Howard_Carter_with_Innermost_Coffin_of_Tutankhamun.jpg/200px-Howard_Carter_with_Innermost_Coffin_of_Tutankhamun.jpg", emoji: "ğŸ”¦" },
      amarna: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/85/House_Altar_Akhenaten_Nefertiti_Berlin.jpg/200px-House_Altar_Akhenaten_Nefertiti_Berlin.jpg", emoji: "ğŸ›ï¸" },
      aten: { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Aten_disk.jpg/200px-Aten_disk.jpg", emoji: "â˜€ï¸" }
    };

    // Pildikomponent
    const QuestionImage = ({ imageData, large = false }) => {
      const [failed, setFailed] = useState(false);
      if (!imageData) return null;
      if (typeof imageData === 'string') {
        return (<div className={`bg-amber-200 rounded-2xl flex items-center justify-center shadow-lg ${large ? 'w-32 h-32 text-8xl' : 'w-20 h-20 text-5xl'}`}>{imageData}</div>);
      }
      if (failed) {
        return (<div className={`bg-amber-200 rounded-2xl flex items-center justify-center shadow-lg ${large ? 'w-32 h-32 text-8xl' : 'w-20 h-20 text-5xl'}`}>{imageData.emoji}</div>);
      }
      return (<img src={imageData.url} alt="" onError={() => setFailed(true)} className={`rounded-2xl shadow-lg object-cover ${large ? 'w-32 h-32' : 'w-20 h-20'}`} />);
    };

    // ========== SÃœNDMUSED ==========
    const randomEvents = [
      { id: 'flood', name: 'Niiluse Ã¼leujutus', icon: 'ğŸŒŠ', description: 'Topelt punktid jÃ¤rgmise 3 kÃ¼simuse eest!', effect: 'doublePoints', duration: 3, positive: true },
      { id: 'blessing', name: 'Vaarao Ãµnnistus', icon: 'ğŸ‘‘', description: 'Saad Ã¼he lisaelu!', effect: 'extraLife', positive: true },
      { id: 'thoth', name: 'Thoti tarkus', icon: 'ğŸ¦¢', description: 'JÃ¤rgmine vihje on tasuta!', effect: 'freeHint', positive: true },
      { id: 'scarab', name: 'Skarabeuse Ãµnn', icon: 'ğŸª²', description: 'JÃ¤rgmine vale vastus ei vÃµta elu!', effect: 'shield', positive: true },
      { id: 'seth', name: 'Sethi needus', icon: 'ğŸŒªï¸', description: 'Kaotad 50 punkti!', effect: 'losePoints', positive: false },
    ];

    // ========== SAAVUTUSED ==========
    const achievements = [
      { id: 'first_correct', name: 'Esimene samm', icon: 'ğŸ‘£', description: 'Vasta Ãµigesti', condition: (s) => s.totalCorrect >= 1 },
      { id: 'streak5', name: 'Tulekahju', icon: 'ğŸ”¥', description: '5 Ãµiget jÃ¤rjest', condition: (s) => s.bestStreak >= 5 },
      { id: 'streak10', name: 'PÃµlev pÃ¤ike', icon: 'â˜€ï¸', description: '10 Ãµiget jÃ¤rjest', condition: (s) => s.bestStreak >= 10 },
      { id: 'collector5', name: 'Koguja', icon: 'ğŸº', description: 'Kogu 5 aaret', condition: (s) => s.treasureCount >= 5 },
      { id: 'scholar10', name: 'Ã•pilane', icon: 'ğŸ“–', description: 'Kogu 10 faktikaarti', condition: (s) => s.factCount >= 10 },
      { id: 'perfect_location', name: 'Perfektne', icon: 'â­', description: 'LÃ¤bi asukoht vigadeta', condition: (s) => s.perfectLocations >= 1 },
      { id: 'pharaoh', name: 'Vaarao', icon: 'ğŸ‘‘', description: 'LÃ¤bi kogu mÃ¤ng', condition: (s) => s.gameCompleted },
    ];

    // ========== KÃœSIMUSED ==========
    const allQuestions = [
      // DELTA
      { id: 1, type: 'choice', location: 'delta', difficulty: 1, question: "Milline jÃµgi oli Vana-Egiptuse tsivilisatsiooni eluandja?", options: ["Niilus", "Eufrat", "Tigris", "Jordani jÃµgi"], correct: 0, image: images.nile, fact: "Niiluse jÃµgi on 6650 km pikk.", treasure: "papyrus" },
      { id: 2, type: 'choice', location: 'delta', difficulty: 1, question: "Kuidas nimetati Niiluse suudmeala?", options: ["Delta", "Oaas", "Org", "MÃ¤gi"], correct: 0, hint: "Kreeka tÃ¤he kuju jÃ¤rgi", image: images.delta, fact: "Delta sai nime Kreeka tÃ¤he Î” jÃ¤rgi.", treasure: "lotus" },
      { id: 150, type: 'truefalse', location: 'delta', difficulty: 1, question: "Kleopatra oli sÃ¼ndinud egiptlane.", correct: false, image: images.cleopatra, explanation: "Kleopatra oli Kreeka pÃ¤ritolu.", fact: "Kleopatra oli esimene, kes Ãµppis Ã¤ra egiptuse keele." },
      { id: 151, type: 'truefalse', location: 'delta', difficulty: 1, question: "Niilus voolab lÃµunast pÃµhja.", correct: true, image: images.nile, explanation: "Niilus voolab Aafrika sÃ¼damest Vahemerre.", fact: "SeepÃ¤rast on Ãœlem-Egiptus lÃµunas." },
      { id: 160, type: 'identify', location: 'delta', difficulty: 1, question: "Kes on see kuulus valitseja?", displayImage: images.cleopatra, options: ["Kleopatra", "Nofretete", "HatÅ¡epsut", "Isis"], correct: 0, fact: "Kleopatra oli Egiptuse viimane iseseisev valitseja." },
      { id: 170, type: 'fillin', location: 'delta', difficulty: 1, question: "Egiptuse viimane valitseja oli _____.", answer: ["kleopatra", "kleopatra vii"], image: images.cleopatra, fact: "Kleopatra suri 30 eKr." },
      { id: 3, type: 'written', location: 'delta', difficulty: 2, question: "Kuidas nimetati Egiptuse lÃµunaosa?", answer: ["Ã¼lem-egiptus", "Ã¼lem egiptus"], hint: "Ãœlesvoolu = Ã¼lemine", image: images.egypt_map, fact: "Ãœlem-Egiptus asus lÃµunas." },
      { id: 9, type: 'choice', location: 'delta', difficulty: 2, question: "Kes vallutas Egiptuse 332 eKr?", options: ["Aleksander Suur", "Julius Caesar", "Ramses II", "Nero"], correct: 0, image: images.alexander, fact: "Aleksander Suurt tervitati vabastajana." },

      // GIZA
      { id: 20, type: 'choice', location: 'giza', difficulty: 1, question: "Mis oli pÃ¼ramiidide eesmÃ¤rk?", options: ["Vaarao hauamonument", "Tempel", "Observatoorium", "Kindlus"], correct: 0, image: images.giza, fact: "PÃ¼ramiidid olid vaaraode hauakambrid.", treasure: "pyramid" },
      { id: 153, type: 'truefalse', location: 'giza', difficulty: 1, question: "PÃ¼ramiide ehitasid orjad.", correct: false, image: images.workers, explanation: "PÃ¼ramiide ehitasid vabad egiptlased.", fact: "Ehitajad said palka." },
      { id: 161, type: 'identify', location: 'giza', difficulty: 1, question: "Milline ehitis on pildil?", displayImage: images.giza, options: ["PÃ¼ramiid", "Tempel", "Palee", "Obelisk"], correct: 0, fact: "Giza pÃ¼ramiidid on ainus sÃ¤ilinud maailmaime." },
      { id: 171, type: 'fillin', location: 'giza', difficulty: 2, question: "Suurima pÃ¼ramiidi ehitas vaarao _____.", answer: ["hufu", "cheops", "khufu"], image: images.giza, fact: "Hufu pÃ¼ramiid koosneb 2,3 miljonist kiviblokist." },
      { id: 24, type: 'written', location: 'giza', difficulty: 2, question: "Milline vaarao ehitas esimese astmikpÃ¼ramiidi?", answer: ["djoser", "dÅ¾oser"], hint: "Tema arhitekt oli Imhotep", image: images.step_pyramid, fact: "Djoseri pÃ¼ramiid on vanim suur kiviehitis.", treasure: "step_pyramid" },
      { id: 25, type: 'choice', location: 'giza', difficulty: 1, question: "Kes ehitas pÃ¼ramiide?", options: ["Vabad egiptlased", "Orjad", "VÃ¤lismaalased", "Preestrid"], correct: 0, image: images.workers, fact: "Ehitajad tÃ¶Ã¶tasid Ã¼leujutuse ajal." },

      // MEMPHIS
      { id: 30, type: 'choice', location: 'memphis', difficulty: 1, question: "Milline linn oli Vana Riigi pealinn?", options: ["Memphis", "Teeba", "Aleksandria", "Kairo"], correct: 0, image: images.sphinx, fact: "Memphis rajati kahe Egiptuse Ã¼hinemisel." },
      { id: 31, type: 'choice', location: 'memphis', difficulty: 1, question: "Kuidas nimetati Egiptuse kuningaid?", options: ["Vaarao", "Keiser", "Kuningas", "Sultaan"], correct: 0, image: images.tutankhamun, fact: "SÃµna 'vaarao' tÃ¤hendab 'suur maja'.", treasure: "crook" },
      { id: 155, type: 'truefalse', location: 'memphis', difficulty: 1, question: "HieroglÃ¼Ã¼fe oli umbes 26 (nagu tÃ¤hestikus).", correct: false, image: images.hieroglyphs, explanation: "HieroglÃ¼Ã¼fe oli umbes 750!", fact: "Hiljem kasvas nende arv Ã¼le 5000." },
      { id: 162, type: 'identify', location: 'memphis', difficulty: 1, question: "Mis ese on pildil?", displayImage: images.rosetta, options: ["Rosette'i kivi", "Hauakivi", "Altar", "Obelisk"], correct: 0, fact: "Rosette'i kivi vÃµimaldas hieroglÃ¼Ã¼fide deÅ¡ifreerimist.", treasure: "rosetta" },
      { id: 172, type: 'fillin', location: 'memphis', difficulty: 2, question: "Egiptuse piltkirja nimetatakse _____.", answer: ["hieroglÃ¼Ã¼fid", "hieroglÃ¼Ã¼fideks"], image: images.hieroglyphs, fact: "HieroglÃ¼Ã¼fe kasutati templites ja haudades.", treasure: "hieroglyph" },
      { id: 32, type: 'written', location: 'memphis', difficulty: 2, question: "Kes Ã¼hendas Ãœlem- ja Alam-Egiptuse?", answer: ["menes", "narmer"], hint: "Esimese dÃ¼nastia rajaja", image: images.narmer, fact: "Menes on poollegendaarne kuningas.", treasure: "crown" },

      // AMARNA
      { id: 50, type: 'choice', location: 'amarna', difficulty: 1, question: "Milline vaarao kehtestas ainujumalakultuse?", options: ["Ehnaton", "Tutanhamon", "Ramses II", "Kleopatra"], correct: 0, image: images.akhenaten, fact: "Ehnaton keelas kÃµik teised jumalad.", treasure: "sun_disk" },
      { id: 157, type: 'truefalse', location: 'amarna', difficulty: 2, question: "Ehnaton uskus paljudesse jumalatesse.", correct: false, image: images.aten, explanation: "Ehnaton kehtestas ainujumalakultuse.", fact: "See oli varasemaid monoteismi vorme." },
      { id: 163, type: 'identify', location: 'amarna', difficulty: 1, question: "Kelle bÃ¼st on pildil?", displayImage: images.nefertiti, options: ["Nofretete", "Kleopatra", "HatÅ¡epsut", "Isis"], correct: 0, fact: "Nofretete bÃ¼st on kuulsaim Egiptuse kunstiteos.", treasure: "bust" },
      { id: 173, type: 'fillin', location: 'amarna', difficulty: 2, question: "Ehnaton austas ainujumalat nimega _____.", answer: ["aton", "aten"], image: images.aten, fact: "Aton oli pÃ¤ikeseketas ise." },
      { id: 53, type: 'written', location: 'amarna', difficulty: 2, question: "Kes oli Ehnatoni kuulus abikaasa?", answer: ["nofretete", "nefertiti"], hint: "Tema bÃ¼st on maailmakuulus", image: images.nefertiti, fact: "Nofretete mÃ¤ngis suurt rolli valitsemises." },

      // ABYDOS
      { id: 60, type: 'choice', location: 'abydos', difficulty: 1, question: "Milline jumal valitses surnuteriiki?", options: ["Osiris", "Ra", "Horus", "Anubis"], correct: 0, image: images.osiris, fact: "Osiris oli kunagi elusate kuningas.", treasure: "djed" },
      { id: 158, type: 'truefalse', location: 'abydos', difficulty: 1, question: "Palsameerimisprotsess kestis 70 pÃ¤eva.", correct: true, image: images.mummy, explanation: "70 pÃ¤eva vastas tÃ¤he Siirius kadumisele.", fact: "Natron kuivatas keha 40 pÃ¤evaga." },
      { id: 164, type: 'identify', location: 'abydos', difficulty: 1, question: "Milline jumal on pildil?", displayImage: images.anubis, options: ["Anubis", "Horus", "Seth", "Osiris"], correct: 0, fact: "Anubis oli Å¡aakalipeaga haudade kaitsja.", treasure: "anubis" },
      { id: 174, type: 'fillin', location: 'abydos', difficulty: 1, question: "Palsameeritud surnukeha nimetatakse _____.", answer: ["muumia", "muumiaks"], image: images.mummy, fact: "SÃµna tuleb araabia sÃµnast 'mumiya'.", treasure: "mummy" },
      { id: 64, type: 'choice', location: 'abydos', difficulty: 1, question: "Kuidas nimetati kirstu, kuhu muumia asetati?", options: ["Sarkofaag", "Muumia", "PÃ¼ramiid", "Tempel"], correct: 0, image: images.sarcophagus, fact: "SÃµna 'sarkofaag' tÃ¤hendab 'lihasÃ¶Ã¶ja'.", treasure: "sarcophagus" },
      { id: 67, type: 'choice', location: 'abydos', difficulty: 2, question: "Milline siseorgan jÃ¤eti kehasse?", options: ["SÃ¼da", "Aju", "Maks", "Kopsud"], correct: 0, image: images.canopic_jars, fact: "SÃ¼dant vajati teispoolsuses kaalumiseks.", treasure: "heart" },

      // TEEBA
      { id: 80, type: 'choice', location: 'teeba', difficulty: 1, question: "Milline linn oli Uue Riigi pealinn?", options: ["Teeba", "Memphis", "Giza", "Aleksandria"], correct: 0, image: images.luxor, fact: "Teeba oli Uue Riigi keskus." },
      { id: 165, type: 'identify', location: 'teeba', difficulty: 1, question: "Milline jumalanna on pildil?", displayImage: images.bastet, options: ["Bastet", "Isis", "Hathor", "Sekhmet"], correct: 0, fact: "Bastet oli kassijumalanna.", treasure: "cat" },
      { id: 175, type: 'fillin', location: 'teeba', difficulty: 2, question: "Kosmilise maailmakorra mÃµistet nimetati _____.", answer: ["maat", "ma'at"], image: images.maat, fact: "Maat oli nii mÃµiste kui jumalanna.", treasure: "feather" },
      { id: 81, type: 'choice', location: 'teeba', difficulty: 1, question: "Milline jumalanna oli kassi kujuga?", options: ["Bastet", "Isis", "Hathor", "Maat"], correct: 0, image: images.bastet, fact: "Bastet muutus leebeks kassijumalannaks." },

      // KARNAK
      { id: 90, type: 'choice', location: 'karnak', difficulty: 1, question: "Milline jumal oli pÃ¤ikesejumal?", options: ["Ra", "Osiris", "Horus", "Anubis"], correct: 0, image: images.ra, fact: "Ra sÃµitis pÃ¤eval Ã¼le taeva.", treasure: "scarab" },
      { id: 166, type: 'identify', location: 'karnak', difficulty: 1, question: "Milline jumal on pildil?", displayImage: images.horus, options: ["Horus", "Ra", "Thot", "Seth"], correct: 0, fact: "Horus kehastus elavat vaaraod.", treasure: "eye" },
      { id: 176, type: 'fillin', location: 'karnak', difficulty: 2, question: "Egiptuse suurim tempel on _____.", answer: ["karnak", "karnaki tempel"], image: images.karnak, fact: "Karnaki templikompleksi ehitati Ã¼le 2000 aasta.", treasure: "column" },
      { id: 91, type: 'choice', location: 'karnak', difficulty: 1, question: "Kuidas nimetati jumalate hooneid?", options: ["Templid", "PÃ¼ramiidid", "Paleed", "Oaasid"], correct: 0, image: images.karnak, fact: "Templid olid jumalate maised kodud.", treasure: "temple" },
      { id: 96, type: 'written', location: 'karnak', difficulty: 2, question: "Milline putukas sÃ¼mboliseeris taassÃ¼ndi?", answer: ["skarabeus", "sitamardikas", "scarab"], hint: "Veeretab sÃµnnikupalli", image: images.scarab, fact: "Skarabeuse pall meenutas pÃ¤ikest.", treasure: "scarab_amulet" },

      // KUNINGATE ORG
      { id: 100, type: 'choice', location: 'kuningate_org', difficulty: 1, question: "Millise vaarao haud avastati 1922?", options: ["Tutanhamon", "Ramses II", "Kleopatra", "Ehnaton"], correct: 0, image: images.tutankhamun, fact: "Tutanhamoni haud sisaldas Ã¼le 5000 eseme.", treasure: "mask" },
      { id: 167, type: 'identify', location: 'kuningate_org', difficulty: 1, question: "Kelle mask on pildil?", displayImage: images.tutankhamun, options: ["Tutanhamon", "Ramses II", "Ehnaton", "Menes"], correct: 0, fact: "Mask kaalub 11 kg ja on puhtast kullast." },
      { id: 177, type: 'fillin', location: 'kuningate_org', difficulty: 2, question: "Tutanhamoni haua avastas _____.", answer: ["howard carter", "carter"], image: images.howard_carter, fact: "Carter otsis hauda 5 aastat." },
      { id: 101, type: 'choice', location: 'kuningate_org', difficulty: 2, question: "Kes avastas Tutanhamoni haua?", options: ["Howard Carter", "Champollion", "Napoleon", "Herodotos"], correct: 0, image: images.howard_carter, fact: "Lord Carnarvon rahastus oli lÃµppemas." },
      { id: 102, type: 'written', location: 'kuningate_org', difficulty: 2, question: "Kuhu maeti Uue Riigi vaaraod?", answer: ["kuningate org", "kuningate orgu"], hint: "Teeba lÃ¤hedal", image: images.valley_kings, fact: "Kuningate org valiti haudade peitmiseks." },

      // ABU SIMBEL
      { id: 110, type: 'choice', location: 'abu_simbel', difficulty: 1, question: "Milline vaarao ehitas Abu Simbeli?", options: ["Ramses II", "Tutanhamon", "Ehnaton", "Kleopatra"], correct: 0, image: images.abu_simbel, fact: "Ramses II ehitas Abu Simbeli.", treasure: "statue" },
      { id: 168, type: 'identify', location: 'abu_simbel', difficulty: 1, question: "Milline tempel on pildil?", displayImage: images.abu_simbel, options: ["Abu Simbel", "Karnak", "Luxor", "Deir al-Bahri"], correct: 0, fact: "Abu Simbeli koliti 1960ndatel." },
      { id: 178, type: 'fillin', location: 'abu_simbel', difficulty: 2, question: "Ramses II valitses _____ aastat.", answer: ["66", "66 aastat"], image: images.ramses_ii, fact: "See oli Ã¼ks pikimaid valitsusaegu." },
      { id: 111, type: 'choice', location: 'abu_simbel', difficulty: 2, question: "Kui kaua Ramses II valitses?", options: ["66 aastat", "10 aastat", "30 aastat", "5 aastat"], correct: 0, image: images.ramses_ii, fact: "Pikk valitsusaeg vÃµimaldas suuri ehitusprojekte." },
      { id: 116, type: 'choice', location: 'abu_simbel', difficulty: 1, question: "Miks oli Niilus tÃ¤htis?", options: ["Ãœleujutused vÃ¤etasid pÃµlde", "Seal elasid jumalad", "Seal pÃ¼Ã¼ti kulda", "Ainus vesi"], correct: 0, image: images.nile, fact: "Ilma Niiluseta poleks pÃµllumajandus vÃµimalik." },
    ];

    // ========== AARDED ==========
    const treasures = {
      papyrus: { name: "PapÃ¼Ã¼rusrull", icon: "ğŸ“œ" }, lotus: { name: "LootosÃµis", icon: "ğŸª·" },
      crown: { name: "Kahekordne kroon", icon: "ğŸ‘‘" }, crook: { name: "Vaarao kepp", icon: "ğŸª" },
      statue: { name: "Abu Simbeli kuju", icon: "ğŸ—¿" }, mask: { name: "Tutanhamoni mask", icon: "ğŸ˜¶" },
      sun_disk: { name: "Atoni ketas", icon: "â˜€ï¸" }, bust: { name: "Nofretete bÃ¼st", icon: "ğŸ‘¸" },
      feather: { name: "Maati sulg", icon: "ğŸª¶" }, scarab: { name: "Skarabeus", icon: "ğŸª²" },
      djed: { name: "Djed-sammas", icon: "ğŸ›ï¸" }, anubis: { name: "Anubise kuju", icon: "ğŸº" },
      eye: { name: "Horose silm", icon: "ğŸ‘ï¸" }, mummy: { name: "Muumia", icon: "ğŸ§Ÿ" },
      sarcophagus: { name: "Sarkofaag", icon: "âš°ï¸" }, heart: { name: "SÃ¼dame amulett", icon: "â¤ï¸" },
      pyramid: { name: "PÃ¼ramiid", icon: "ğŸ”º" }, hieroglyph: { name: "HieroglÃ¼Ã¼fid", icon: "ğ“€€" },
      temple: { name: "Templi mudel", icon: "ğŸ›ï¸" }, step_pyramid: { name: "AstmikpÃ¼ramiid", icon: "ğŸ“" },
      rosetta: { name: "Rosette'i kivi", icon: "ğŸª¨" }, column: { name: "Karnaki sammas", icon: "ğŸ›ï¸" },
      cat: { name: "Kassimuumia", icon: "ğŸ±" }, scarab_amulet: { name: "Skarabeuse amulett", icon: "ğŸ’" }
    };

    // ========== ASUKOHAD ==========
    const locations = [
      { id: 'delta', name: 'Niiluse delta', icon: 'ğŸŒŠ', x: 50, y: 10 },
      { id: 'giza', name: 'Giza', icon: 'ğŸ”º', x: 45, y: 20 },
      { id: 'memphis', name: 'Memphis', icon: 'ğŸ›ï¸', x: 48, y: 28 },
      { id: 'amarna', name: 'Amarna', icon: 'â˜€ï¸', x: 55, y: 42 },
      { id: 'abydos', name: 'Abydos', icon: 'âš±ï¸', x: 45, y: 52 },
      { id: 'teeba', name: 'Teeba', icon: 'ğŸº', x: 52, y: 62 },
      { id: 'karnak', name: 'Karnak', icon: 'ğŸŒ™', x: 55, y: 70 },
      { id: 'kuningate_org', name: 'Kuningate org', icon: 'ğŸ‘‘', x: 48, y: 78 },
      { id: 'abu_simbel', name: 'Abu Simbel', icon: 'ğŸ—¿', x: 52, y: 90 }
    ];

    // ========== PEAKOMPONENT ==========
    const NiiluseTeekond = () => {
      const { playSound, soundEnabled, setSoundEnabled, initAudio } = useSounds();
      const [playerName, setPlayerName] = useState('');
      const [currentLocation, setCurrentLocation] = useState(0);
      const [lives, setLives] = useState(3);
      const [hints, setHints] = useState(3);
      const [streak, setStreak] = useState(0);
      const [bestStreak, setBestStreak] = useState(0);
      const [score, setScore] = useState(0);
      const [collectedTreasures, setCollectedTreasures] = useState([]);
      const [factCards, setFactCards] = useState([]);
      const [answeredQuestions, setAnsweredQuestions] = useState(new Set());
      const [unlockedAchievements, setUnlockedAchievements] = useState([]);
      const [stats, setStats] = useState({ totalCorrect: 0, totalAnswered: 0, perfectLocations: 0, recoveries: 0, trueFalseCorrect: 0, gameCompleted: false });
      const [activeEvent, setActiveEvent] = useState(null);
      const [eventCounter, setEventCounter] = useState(0);
      const [shield, setShield] = useState(false);
      const [freeHint, setFreeHint] = useState(false);
      const [showEventModal, setShowEventModal] = useState(false);
      const [pendingEvent, setPendingEvent] = useState(null);
      const [currentQuestion, setCurrentQuestion] = useState(null);
      const [questionQueue, setQuestionQueue] = useState([]);
      const [userAnswer, setUserAnswer] = useState('');
      const [selectedOption, setSelectedOption] = useState(null);
      const [showResult, setShowResult] = useState(false);
      const [isCorrect, setIsCorrect] = useState(false);
      const [showHint, setShowHint] = useState(false);
      const [locationMistakes, setLocationMistakes] = useState(0);
      const [screen, setScreen] = useState('start');
      const [showTreasureRoom, setShowTreasureRoom] = useState(false);
      const [showFactCards, setShowFactCards] = useState(false);
      const [showAchievements, setShowAchievements] = useState(false);
      const [notification, setNotification] = useState(null);
      const [fallingBack, setFallingBack] = useState(false);
      const [newAchievement, setNewAchievement] = useState(null);

      const normalizeAnswer = (answer) => answer.toLowerCase().trim().replace(/[.,!?]/g, '').replace(/\s+/g, ' ');
      const checkWrittenAnswer = (userAns, correctAnswers) => correctAnswers.some(ans => normalizeAnswer(ans) === normalizeAnswer(userAns));
      const getQuestionsForLocation = (locationId) => allQuestions.filter(q => q.location === locationId && !answeredQuestions.has(q.id));
      const showNotification = (message, type = 'info') => { setNotification({ message, type }); setTimeout(() => setNotification(null), 3000); };

      const checkAchievements = useCallback((newStats) => {
        const statsWithCounts = { ...newStats, treasureCount: collectedTreasures.length, factCount: factCards.length };
        achievements.forEach(achievement => {
          if (!unlockedAchievements.includes(achievement.id) && achievement.condition(statsWithCounts)) {
            setUnlockedAchievements(prev => [...prev, achievement.id]);
            setNewAchievement(achievement);
            playSound('achievement');
            setTimeout(() => setNewAchievement(null), 3000);
          }
        });
      }, [unlockedAchievements, collectedTreasures.length, factCards.length, playSound]);

      const triggerRandomEvent = useCallback(() => {
        if (Math.random() < 0.15) {
          const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
          setPendingEvent(event);
          setShowEventModal(true);
          playSound('event');
        }
      }, [playSound]);

      const applyEvent = (event) => {
        setShowEventModal(false);
        switch (event.effect) {
          case 'doublePoints': setActiveEvent({ ...event, remaining: event.duration }); setEventCounter(event.duration); break;
          case 'extraLife': setLives(prev => Math.min(prev + 1, 5)); break;
          case 'freeHint': setFreeHint(true); break;
          case 'shield': setShield(true); break;
          case 'losePoints': setScore(prev => Math.max(0, prev - 50)); break;
        }
        setPendingEvent(null);
      };

      const shuffleQuestions = (questions, count = 4) => {
        const shuffled = [...questions].sort(() => Math.random() - 0.5);
        return shuffled.slice(0, Math.min(count, shuffled.length)).sort((a, b) => a.difficulty - b.difficulty);
      };

      const startGame = async () => {
        if (!playerName.trim()) { showNotification('Palun sisesta oma nimi!', 'warning'); return; }
        await initAudio();
        playSound('click');
        setCurrentLocation(0); setLives(3); setHints(3); setStreak(0); setBestStreak(0); setScore(0);
        setCollectedTreasures([]); setFactCards([]); setAnsweredQuestions(new Set()); setUnlockedAchievements([]);
        setStats({ totalCorrect: 0, totalAnswered: 0, perfectLocations: 0, recoveries: 0, trueFalseCorrect: 0, gameCompleted: false });
        setActiveEvent(null); setEventCounter(0); setShield(false); setFreeHint(false); setFallingBack(false); setLocationMistakes(0);
        setScreen('map');
      };

      const enterLocation = (locationIndex) => {
        playSound('click');
        const location = locations[locationIndex];
        const questions = getQuestionsForLocation(location.id);
        if (questions.length === 0) {
          if (locationIndex < locations.length - 1) { setCurrentLocation(locationIndex + 1); showNotification('âœ¨ KÃµik vastatud!', 'success'); playSound('levelup'); }
          else { setStats(s => ({ ...s, gameCompleted: true })); setScreen('victory'); playSound('victory'); }
          return;
        }
        setLocationMistakes(0);
        const balanced = shuffleQuestions(questions, 4);
        setQuestionQueue(balanced);
        loadNextQuestion(balanced);
      };

      const loadNextQuestion = (queue = questionQueue) => {
        if (queue.length === 0) {
          if (locationMistakes === 0) { const newStats = { ...stats, perfectLocations: stats.perfectLocations + 1 }; setStats(newStats); checkAchievements(newStats); }
          if (currentLocation < locations.length - 1) { setCurrentLocation(prev => prev + 1); setScreen('map'); showNotification(`ğŸ‰ Tubli, ${playerName}!`, 'success'); playSound('levelup'); }
          else { setStats(s => ({ ...s, gameCompleted: true })); setScreen('victory'); playSound('victory'); }
          return;
        }
        const [next, ...rest] = queue;
        setCurrentQuestion(next); setQuestionQueue(rest); setUserAnswer(''); setSelectedOption(null); setShowResult(false); setShowHint(false); setScreen('question');
      };

      const submitAnswer = () => {
        if (!currentQuestion) return;
        let correct = false;
        switch (currentQuestion.type) {
          case 'written': case 'fillin': correct = checkWrittenAnswer(userAnswer, currentQuestion.answer); break;
          case 'choice': case 'identify': correct = selectedOption === currentQuestion.correct; break;
          case 'truefalse': correct = selectedOption === currentQuestion.correct; break;
        }
        setIsCorrect(correct); setShowResult(true); setAnsweredQuestions(prev => new Set([...prev, currentQuestion.id]));
        const newStats = { ...stats, totalAnswered: stats.totalAnswered + 1, totalCorrect: correct ? stats.totalCorrect + 1 : stats.totalCorrect, trueFalseCorrect: (correct && currentQuestion.type === 'truefalse') ? stats.trueFalseCorrect + 1 : stats.trueFalseCorrect };
        setStats(newStats);

        if (correct) {
          playSound('correct');
          let points = 100 + Math.floor(streak / 3) * 10;
          if (activeEvent?.effect === 'doublePoints') { points *= 2; setEventCounter(prev => { const n = prev - 1; if (n <= 0) setActiveEvent(null); return n; }); }
          setScore(prev => prev + points); setStreak(prev => prev + 1); if (streak + 1 > bestStreak) setBestStreak(streak + 1);
          if (currentQuestion.treasure && treasures[currentQuestion.treasure] && !collectedTreasures.includes(currentQuestion.treasure)) {
            setCollectedTreasures(prev => [...prev, currentQuestion.treasure]);
            setTimeout(() => { playSound('treasure'); showNotification(`ğŸ’ ${treasures[currentQuestion.treasure].name}!`, 'treasure'); }, 500);
          }
          if (currentQuestion.fact) { setFactCards(prev => prev.some(f => f.id === currentQuestion.id) ? prev : [...prev, { id: currentQuestion.id, question: currentQuestion.question, fact: currentQuestion.fact, image: currentQuestion.image }]); }
          if ((streak + 1) % 5 === 0) { setHints(prev => Math.min(prev + 1, 5)); playSound('streak'); }
          triggerRandomEvent();
          checkAchievements(newStats);
        } else {
          playSound('wrong'); setStreak(0); setLocationMistakes(prev => prev + 1);
          if (shield) { setShield(false); showNotification('ğŸª² Skarabeus kaitses!', 'bonus'); }
          else { const newLives = lives - 1; setLives(newLives); if (newLives <= 0) { setFallingBack(true); playSound('fall'); } }
        }
      };

      const handleFallBack = () => {
        setFallingBack(false); setLives(3);
        const newStats = { ...stats, recoveries: stats.recoveries + 1 }; setStats(newStats); checkAchievements(newStats);
        if (currentLocation > 0) { setCurrentLocation(prev => prev - 1); showNotification(`ğŸ˜µ Tagasi: ${locations[currentLocation - 1].name}`, 'warning'); }
        else { showNotification(`ğŸ˜µ Proovi uuesti!`, 'warning'); }
        setScreen('map');
      };

      const useHint = () => {
        if (showHint) return;
        if (freeHint) { setFreeHint(false); setShowHint(true); showNotification('ğŸ¦¢ Thoti tasuta vihje!', 'bonus'); }
        else if (hints > 0) { playSound('click'); setHints(prev => prev - 1); setShowHint(true); }
      };

      const nextQuestion = () => { playSound('click'); if (fallingBack) { handleFallBack(); return; } loadNextQuestion(); };

      // ========== EKRAANID ==========
      if (screen === 'start') {
        return (
          <div className="min-h-screen bg-gradient-to-b from-amber-900 via-amber-800 to-amber-950 flex items-center justify-center p-4 relative overflow-hidden">
            <div className="bg-sand absolute inset-0 pointer-events-none"></div>
            <div className="max-w-2xl w-full text-center relative z-10">
              <div className="mb-8 animate-float">
                <h1 className="text-6xl md:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-b from-amber-200 to-amber-500 mb-2 tracking-tighter">
                  ğ“‚€ NIILUSE TEEKOND ğ“‚€
                </h1>
                <p className="text-2xl text-amber-300/80 font-light tracking-widest uppercase">Vana-Egiptuse seiklus</p>
              </div>

              <div className="text-7xl mb-10 flex justify-center gap-4 drop-shadow-2xl">
                <span className="hover:scale-110 transition-transform cursor-default">ğŸ›ï¸</span>
                <span className="hover:scale-110 transition-transform cursor-default">ğŸª</span>
                <span className="hover:scale-110 transition-transform cursor-default">ğŸ”º</span>
                <span className="hover:scale-110 transition-transform cursor-default">ğŸ</span>
              </div>

              <div className="glass rounded-3xl p-8 mb-8 shadow-2xl border-amber-500/30">
                <label className="block text-amber-200 text-sm font-semibold mb-4 uppercase tracking-wider">Sisesta oma nimi, rÃ¤ndur</label>
                <input
                  type="text"
                  value={playerName}
                  onChange={(e) => setPlayerName(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && playerName.trim() && startGame()}
                  placeholder="Nimi..."
                  className="w-full p-5 text-2xl text-center rounded-2xl border-2 border-amber-500/50 bg-amber-950/40 text-amber-100 placeholder-amber-700/50 focus:border-amber-400 focus:ring-4 focus:ring-amber-500/20 focus:outline-none transition-all"
                  maxLength={15}
                />
              </div>

              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10 text-amber-200/70">
                <div className="glass-light/10 p-3 rounded-2xl border border-amber-500/10">
                  <span className="block text-2xl mb-1">ğŸ—ºï¸</span>
                  <span className="text-xs font-bold uppercase">9 Asukohta</span>
                </div>
                <div className="glass-light/10 p-3 rounded-2xl border border-amber-500/10">
                  <span className="block text-2xl mb-1">ğŸ’</span>
                  <span className="text-xs font-bold uppercase">Aarded</span>
                </div>
                <div className="glass-light/10 p-3 rounded-2xl border border-amber-500/10">
                  <span className="block text-2xl mb-1">ğŸ†</span>
                  <span className="text-xs font-bold uppercase">Saavutused</span>
                </div>
                <div className="glass-light/10 p-3 rounded-2xl border border-amber-500/10">
                  <span className="block text-2xl mb-1">ğŸ²</span>
                  <span className="text-xs font-bold uppercase">SÃ¼ndmused</span>
                </div>
              </div>

              <button
                onClick={startGame}
                disabled={!playerName.trim()}
                className="btn-egypt bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-400 hover:to-amber-500 disabled:from-gray-700 disabled:to-gray-800 disabled:opacity-50 text-amber-950 font-black text-3xl py-5 px-16 rounded-2xl transition-all shadow-xl active:scale-95"
              >
                ALUSTA TEEKONDA ğ“´
              </button>
            </div>
          </div>
        );
      }

      if (screen === 'map') {
        return (
          <div className="min-h-screen bg-gradient-to-b from-blue-900 via-amber-800 to-amber-950 p-4 relative overflow-hidden">
            <div className="bg-sand absolute inset-0 pointer-events-none opacity-10"></div>
            <div className="max-w-4xl mx-auto mb-6 relative z-10">
              <div className="glass rounded-3xl p-4 flex flex-wrap justify-between items-center gap-4 shadow-2xl border-amber-500/20">
                <div className="flex gap-4 items-center">
                  <div className="bg-amber-500/20 px-4 py-2 rounded-2xl border border-amber-500/30">
                    <span className="text-amber-200 font-black text-lg tracking-tight uppercase">{playerName}</span>
                  </div>
                  <div className="flex gap-2 bg-black/30 px-3 py-2 rounded-2xl">
                    {[...Array(3)].map((_, i) => (
                      <span key={i} className={`text-2xl transition-all duration-500 ${i < lives ? 'drop-shadow-[0_0_8px_rgba(251,191,36,0.8)]' : 'opacity-20 grayscale'}`}>
                        {i === 0 ? 'ğ“‚“' : i === 1 ? 'ğ“…ƒ' : 'ğ“‹¹'}
                      </span>
                    ))}
                  </div>
                  <div className="bg-blue-900/40 px-4 py-2 rounded-2xl border border-blue-400/30 flex items-center gap-2">
                    <span className="text-2xl">ğŸª¶</span>
                    <span className="text-blue-200 font-bold">{hints}</span>
                  </div>
                </div>

                <div className="flex gap-4 items-center">
                  {streak >= 3 && <div className="animate-bounce bg-orange-600 text-white px-3 py-1 rounded-full text-sm font-black shadow-lg shadow-orange-600/50">ğŸ”¥ {streak}</div>}
                  <div className="text-3xl font-black text-amber-400 drop-shadow-md tracking-tighter">{score}<span className="text-xs uppercase ml-1 opacity-70 text-amber-200">pt</span></div>
                  <button onClick={() => { playSound('click'); setSoundEnabled(!soundEnabled); }} className="p-2 hover:bg-white/10 rounded-full transition-colors">
                    <span className="text-2xl">{soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'}</span>
                  </button>
                </div>

                <div className="flex gap-2 w-full md:w-auto">
                  <button onClick={() => { playSound('click'); setShowTreasureRoom(true); }} className="flex-1 md:flex-none glass-light/10 hover:bg-white/10 text-amber-200 px-4 py-2 rounded-2xl text-sm font-bold border border-amber-500/20 transition-all flex items-center justify-center gap-2">
                    <span>ğŸ’</span> {collectedTreasures.length}
                  </button>
                  <button onClick={() => { playSound('click'); setShowFactCards(true); }} className="flex-1 md:flex-none glass-light/10 hover:bg-white/10 text-amber-200 px-4 py-2 rounded-2xl text-sm font-bold border border-amber-500/20 transition-all flex items-center justify-center gap-2">
                    <span>ğŸ“š</span> {factCards.length}
                  </button>
                  <button onClick={() => { playSound('click'); setShowAchievements(true); }} className="flex-1 md:flex-none glass-light/10 hover:bg-white/10 text-amber-200 px-4 py-2 rounded-2xl text-sm font-bold border border-amber-500/20 transition-all flex items-center justify-center gap-2">
                    <span>ğŸ†</span> {unlockedAchievements.length}
                  </button>
                </div>
              </div>
            </div>

            <div className="max-w-4xl mx-auto relative z-10">
              <div className="relative bg-gradient-to-b from-amber-200 via-amber-300 to-amber-500 rounded-[40px] p-8 shadow-[0_30px_60px_-12px_rgba(0,0,0,0.5)] border-4 border-amber-100/50 overflow-hidden" style={{ minHeight: '600px' }}>
                {/* River Background Pattern */}
                <div className="absolute inset-0 opacity-10 pointer-events-none bg-sandpaper"></div>

                {/* The Nile */}
                <div className="absolute left-1/2 top-0 bottom-0 w-12 bg-gradient-to-r from-blue-600 via-blue-400 to-blue-600 transform -translate-x-1/2 rounded-full opacity-40 blur-sm shadow-inner" />
                <div className="absolute left-1/2 top-0 bottom-0 w-8 bg-gradient-to-r from-blue-500 via-blue-300 to-blue-500 transform -translate-x-1/2 rounded-full opacity-60 animate-pulse" />

                {locations.map((loc, idx) => (
                  <div key={loc.id} className="absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-700" style={{ left: `${loc.x}%`, top: `${loc.y}%` }}>
                    <div className="relative">
                      {idx === currentLocation && (
                        <div className="absolute -inset-4 bg-amber-400 rounded-full animate-ping opacity-20"></div>
                      )}
                      <button
                        onClick={() => idx === currentLocation && enterLocation(idx)}
                        disabled={idx !== currentLocation}
                        className={`relative w-20 h-20 rounded-3xl flex items-center justify-center text-4xl transition-all duration-500 shadow-xl
                          ${idx < currentLocation ? 'bg-green-600/40 text-green-100 opacity-60 scale-90 border-2 border-green-500/30' :
                            idx === currentLocation ? 'bg-amber-600 text-white scale-125 border-4 border-amber-100 hover:rotate-12 cursor-pointer z-20' :
                              'bg-amber-900/20 text-amber-900/30 opacity-40 scale-75 border-2 border-amber-900/10'}`}
                      >
                        {loc.icon}
                        {idx === currentLocation && (
                          <div className="absolute -top-12 left-1/2 transform -translate-x-1/2 glass px-4 py-2 rounded-xl text-sm font-black text-amber-200 whitespace-nowrap border border-amber-400/50 shadow-xl animate-float">
                            {loc.name}
                          </div>
                        )}
                        {idx < currentLocation && <span className="absolute -top-2 -right-2 text-xl">âœ…</span>}
                      </button>
                    </div>
                  </div>
                ))}
              </div>
              <p className="text-center mt-8 text-amber-200/60 font-medium uppercase tracking-[0.2em] animate-pulse">
                Liigu edasi mÃ¶Ã¶da Niilust...
              </p>
            </div>

            {/* Modals with enhanced styling */}
            {showTreasureRoom && (
              <div className="fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center z-50 p-4" onClick={() => setShowTreasureRoom(false)}>
                <div className="glass rounded-[40px] p-8 max-w-2xl w-full border-2 border-amber-500/30 shadow-[0_0_50px_rgba(251,191,36,0.2)]" onClick={e => e.stopPropagation()}>
                  <div className="flex justify-between items-center mb-8 border-b border-amber-500/20 pb-4">
                    <h2 className="text-4xl font-black text-amber-200 tracking-tighter uppercase italic">ğ“Š Aarete Saun</h2>
                    <button onClick={() => setShowTreasureRoom(false)} className="bg-amber-500/20 hover:bg-amber-500/40 text-amber-400 w-12 h-12 rounded-full flex items-center justify-center transition-all">âœ•</button>
                  </div>
                  {collectedTreasures.length === 0 ? (
                    <div className="py-20 text-center">
                      <div className="text-6xl opacity-20 mb-4">ğŸº</div>
                      <p className="text-amber-300/50 text-xl font-medium">Sulle pole veel aardeid annetatud.</p>
                    </div>
                  ) : (
                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-6 py-4">
                      {collectedTreasures.map(id => (
                        <div key={id} className="group relative">
                          <div className="absolute -inset-1 bg-gradient-to-r from-amber-600 to-amber-400 rounded-3xl blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200"></div>
                          <div className="relative bg-amber-950/80 rounded-3xl p-4 text-center border border-amber-500/20 hover:scale-105 transition-all">
                            <div className="text-5xl mb-2 drop-shadow-lg">{treasures[id]?.icon}</div>
                            <div className="text-amber-200 text-xs font-black uppercase tracking-widest leading-tight">{treasures[id]?.name}</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            )}
            {showFactCards && (
              <div className="fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center z-50 p-4" onClick={() => setShowFactCards(false)}>
                <div className="glass rounded-[40px] p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto border-2 border-amber-500/30" onClick={e => e.stopPropagation()}>
                  <div className="flex justify-between items-center mb-8 border-b border-amber-500/20 pb-4">
                    <h2 className="text-4xl font-black text-amber-200 tracking-tighter uppercase italic">ğ“ Tarkuse Arhiiv</h2>
                    <button onClick={() => setShowFactCards(false)} className="bg-amber-500/20 hover:bg-amber-500/40 text-amber-400 w-12 h-12 rounded-full flex items-center justify-center transition-all">âœ•</button>
                  </div>
                  {factCards.length === 0 ? (
                    <div className="py-20 text-center text-amber-300/50 text-xl">Arhiiv on tÃ¼hi...</div>
                  ) : (
                    <div className="space-y-4">
                      {factCards.map((card, idx) => (
                        <div key={idx} className="bg-amber-950/60 rounded-3xl p-6 flex gap-6 items-start border border-amber-500/10 hover:border-amber-500/30 transition-all">
                          {card.image && <img src={card.image.url} alt="" className="w-20 h-20 rounded-2xl object-cover flex-shrink-0 border-2 border-amber-500/20" onError={(e) => e.target.style.display = 'none'} />}
                          <div>
                            <div className="text-amber-200 text-sm italic mb-2 opacity-60">"Kas teadsid, et..."</div>
                            <div className="text-amber-100 font-medium leading-relaxed">{card.fact}</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            )}

            {showAchievements && (
              <div className="fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center z-50 p-4" onClick={() => setShowAchievements(false)}>
                <div className="glass rounded-[40px] p-8 max-w-3xl w-full max-h-[80vh] overflow-y-auto border-2 border-amber-500/30" onClick={e => e.stopPropagation()}>
                  <div className="flex justify-between items-center mb-8 border-b border-amber-500/20 pb-4">
                    <h2 className="text-4xl font-black text-amber-200 tracking-tighter uppercase italic">ğ“‹¹ Vaarao Autasud</h2>
                    <button onClick={() => setShowAchievements(false)} className="bg-amber-500/20 hover:bg-amber-500/40 text-amber-400 w-12 h-12 rounded-full flex items-center justify-center transition-all">âœ•</button>
                  </div>
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {achievements.map(a => {
                      const unlocked = unlockedAchievements.includes(a.id);
                      return (
                        <div key={a.id} className={`rounded-3xl p-6 flex items-center gap-4 border-2 transition-all ${unlocked ? 'bg-amber-500/20 border-amber-500/50 shadow-[0_0_20px_rgba(251,191,36,0.2)]' : 'bg-black/40 border-white/5 opacity-50'}`}>
                          <div className={`text-4xl w-16 h-16 flex items-center justify-center rounded-2xl ${unlocked ? 'bg-amber-400 text-amber-950 rotate-3' : 'bg-gray-800 rotate-0'}`}>{a.icon}</div>
                          <div>
                            <div className={`font-black uppercase tracking-tighter ${unlocked ? 'text-amber-200' : 'text-gray-500'}`}>{a.name}</div>
                            <div className={`text-xs ${unlocked ? 'text-amber-300/80' : 'text-gray-600'}`}>{a.description}</div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            )}

            {showEventModal && pendingEvent && (
              <div className="fixed inset-0 bg-black/95 backdrop-blur-xl flex items-center justify-center z-[100] p-4">
                <div className={`rounded-[40px] p-10 max-w-md w-full text-center relative overflow-hidden border-4 ${pendingEvent.positive ? 'bg-gradient-to-b from-green-900 via-green-950 to-black border-green-500/50' : 'bg-gradient-to-b from-red-900 via-red-950 to-black border-red-500/50'}`}>
                  <div className="bg-sand absolute inset-0 opacity-10 pointer-events-none"></div>
                  <div className="text-8xl mb-6 animate-float relative z-10 drop-shadow-[0_0_20px_rgba(255,255,255,0.3)]">{pendingEvent.icon}</div>
                  <h2 className="text-4xl font-black text-white mb-4 uppercase tracking-tighter relative z-10">{pendingEvent.name}</h2>
                  <p className="text-xl text-white/80 mb-10 font-medium relative z-10 font-light italic leading-relaxed">"{pendingEvent.description}"</p>
                  <button onClick={() => applyEvent(pendingEvent)} className="w-full bg-white text-black font-black py-5 rounded-3xl text-xl shadow-2xl active:scale-95 transition-transform relative z-10 uppercase tracking-widest">
                    VÃµta vastu ğ“ 
                  </button>
                </div>
              </div>
            )}

            {notification && (
              <div className={`fixed top-8 left-1/2 transform -translate-x-1/2 px-8 py-4 rounded-full shadow-2xl z-[110] animate-in slide-in-from-top duration-500 flex items-center gap-3 border-2 ${notification.type === 'success' ? 'bg-green-600 border-green-400' :
                notification.type === 'treasure' ? 'bg-amber-600 border-amber-400' :
                  notification.type === 'bonus' ? 'bg-purple-600 border-purple-400' :
                    notification.type === 'warning' ? 'bg-red-600 border-red-400' : 'bg-blue-600 border-blue-400'} text-white font-black uppercase tracking-tighter text-sm`}>
                <span className="text-xl">{notification.type === 'treasure' ? 'ğŸ’' : 'âœ¨'}</span>
                {notification.message}
              </div>
            )}

            {newAchievement && (
              <div className="fixed bottom-8 right-8 bg-gradient-to-r from-amber-600 to-amber-500 text-white p-6 rounded-[32px] shadow-[0_20px_50px_rgba(0,0,0,0.5)] z-[120] animate-in slide-in-from-right duration-500 flex items-center gap-6 border-2 border-amber-300/30">
                <div className="text-5xl bg-white/20 w-20 h-20 flex items-center justify-center rounded-3xl rotate-6 animate-bounce">{newAchievement.icon}</div>
                <div>
                  <div className="text-xs font-black uppercase tracking-[0.2em] mb-1 opacity-70">Uus saavutus!</div>
                  <div className="text-2xl font-black uppercase tracking-tighter">{newAchievement.name}</div>
                </div>
              </div>
            )}
          </div>
        );
      }

      if (screen === 'question' && currentQuestion) {
        const typeLabel = { written: 'âœï¸ Kirjuta', fillin: 'ğŸ“ LÃ¼nk', choice: 'ğŸ”˜ Vali', identify: 'ğŸ” Tuvasta', truefalse: 'âš–ï¸ TÃµene/vÃ¤Ã¤r' };
        return (
          <div className="min-h-screen bg-gradient-to-b from-amber-900 via-amber-950 to-black p-4 relative overflow-hidden">
            <div className="bg-sand absolute inset-0 pointer-events-none opacity-5"></div>

            <div className="max-w-2xl mx-auto mb-6 relative z-10">
              <div className="glass rounded-3xl p-4 flex justify-between items-center shadow-xl border-amber-500/20">
                <div className="flex gap-4 items-center">
                  <div className="flex gap-2">
                    {[...Array(3)].map((_, i) => (
                      <span key={i} className={`text-2xl transition-all ${i < lives ? 'drop-shadow-[0_0_8px_rgba(251,191,36,0.6)]' : 'opacity-20 grayscale'}`}>
                        {i === 0 ? 'ğ“‚“' : i === 1 ? 'ğ“…ƒ' : 'ğ“‹¹'}
                      </span>
                    ))}
                  </div>
                  {streak >= 3 && <div className="bg-orange-600 px-3 py-1 rounded-full text-xs font-black text-white animate-pulse">ğŸ”¥ {streak}</div>}
                </div>
                <div className="flex items-center gap-4">
                  <div className="text-right">
                    <div className="text-amber-200 text-[10px] font-black uppercase tracking-widest leading-none mb-1">Asukoht</div>
                    <div className="text-amber-400 font-bold text-sm">{locations[currentLocation]?.name}</div>
                  </div>
                  <button onClick={() => setSoundEnabled(!soundEnabled)} className="w-10 h-10 flex items-center justify-center hover:bg-white/10 rounded-full transition-colors">
                    <span className="text-xl">{soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'}</span>
                  </button>
                </div>
              </div>
            </div>

            <div className="max-w-2xl mx-auto relative z-10">
              <div className="bg-white rounded-[40px] shadow-[0_40px_100px_-20px_rgba(0,0,0,0.8)] overflow-hidden border-8 border-amber-950/20">
                <div className="bg-amber-900 text-amber-100 p-4 flex justify-between items-center font-black uppercase tracking-widest text-xs px-8">
                  <span className="bg-amber-800 px-4 py-1.5 rounded-full border border-amber-500/30">{typeLabel[currentQuestion.type]}</span>
                  <div className="flex gap-1">
                    {[...Array(currentQuestion.difficulty)].map((_, i) => <span key={i} className="text-amber-400 drop-shadow-[0_0_5px_rgba(251,191,36,0.8)]">â­</span>)}
                  </div>
                </div>

                <div className="bg-amber-50 p-6 flex justify-center items-center min-h-[250px] relative">
                  <div className="absolute inset-0 bg-cream-paper opacity-20"></div>
                  {(currentQuestion.displayImage || currentQuestion.image) && (
                    <div className="relative group transition-transform duration-500 hover:scale-105">
                      <div className="absolute inset-0 bg-amber-500 rounded-3xl blur-xl opacity-20 group-hover:opacity-40 transition-opacity"></div>
                      <QuestionImage imageData={currentQuestion.displayImage || currentQuestion.image} large={true} />
                    </div>
                  )}
                </div>

                <div className="p-8 pb-12 bg-white relative">
                  <h2 className="text-3xl font-black text-amber-950 mb-10 text-center leading-tight tracking-tight">
                    {currentQuestion.question}
                  </h2>

                  {showHint && currentQuestion.hint && (
                    <div className="bg-blue-50 border-l-8 border-blue-500 p-5 mb-8 rounded-2xl text-blue-900 animate-in slide-in-from-left duration-500 shadow-sm italic">
                      <div className="flex items-center gap-3">
                        <span className="text-3xl">ğŸ’¡</span>
                        <p className="font-semibold text-lg">{currentQuestion.hint}</p>
                      </div>
                    </div>
                  )}

                  {!showResult && (
                    <div className="space-y-4">
                      {currentQuestion.type === 'truefalse' && (
                        <div className="flex gap-6">
                          <button onClick={() => { playSound('click'); setSelectedOption(true); }} className={`flex-1 btn-egypt p-6 rounded-3xl border-4 text-2xl font-black uppercase tracking-tighter transition-all ${selectedOption === true ? 'border-green-500 bg-green-500 text-white' : 'border-amber-100 bg-amber-50 text-amber-900'}`}>
                            ğ“¹ TÃµene
                          </button>
                          <button onClick={() => { playSound('click'); setSelectedOption(false); }} className={`flex-1 btn-egypt p-6 rounded-3xl border-4 text-2xl font-black uppercase tracking-tighter transition-all ${selectedOption === false ? 'border-red-500 bg-red-500 text-white' : 'border-amber-100 bg-amber-50 text-amber-900'}`}>
                            ğ“´ VÃ¤Ã¤r
                          </button>
                        </div>
                      )}

                      {(currentQuestion.type === 'choice' || currentQuestion.type === 'identify') && (
                        <div className="grid gap-3">
                          {currentQuestion.options.map((option, idx) => (
                            <button
                              key={idx}
                              onClick={() => { playSound('click'); setSelectedOption(idx); }}
                              className={`w-full btn-egypt p-5 text-left rounded-3xl border-4 text-lg font-bold transition-all flex items-center gap-4
                                ${selectedOption === idx ? 'border-amber-500 bg-amber-500 text-white' : 'border-amber-100 bg-amber-50 text-amber-950 hover:bg-amber-100'}`}
                            >
                              <span className={`w-10 h-10 flex items-center justify-center rounded-2xl text-sm font-black transition-colors ${selectedOption === idx ? 'bg-white/20' : 'bg-amber-950/10'}`}>
                                {String.fromCharCode(65 + idx)}
                              </span>
                              {option}
                            </button>
                          ))}
                        </div>
                      )}

                      {(currentQuestion.type === 'written' || currentQuestion.type === 'fillin') && (
                        <input
                          type="text"
                          value={userAnswer}
                          onChange={(e) => setUserAnswer(e.target.value)}
                          onKeyDown={(e) => e.key === 'Enter' && userAnswer.trim() && submitAnswer()}
                          placeholder="..."
                          className="w-full p-6 text-3xl font-black text-center border-4 border-amber-100 rounded-[32px] focus:border-amber-500 focus:bg-amber-50 focus:outline-none transition-all placeholder:opacity-20 text-amber-950"
                          autoFocus
                        />
                      )}

                      <div className="flex gap-4 mt-10">
                        <button
                          onClick={useHint}
                          disabled={!currentQuestion.hint || showHint || (!freeHint && hints <= 0)}
                          className={`w-20 h-20 rounded-3xl transition-all flex items-center justify-center text-3xl shadow-lg
                            ${currentQuestion.hint && !showHint && (freeHint || hints > 0) ? 'bg-blue-500 hover:bg-blue-600 text-white hover:scale-105' : 'bg-gray-100 text-gray-300'}`}
                        >
                          {freeHint ? 'ğŸ¦¢' : 'ğŸª¶'}
                        </button>
                        <button
                          onClick={submitAnswer}
                          disabled={(currentQuestion.type === 'written' && !userAnswer.trim()) || (currentQuestion.type === 'fillin' && !userAnswer.trim()) || ((currentQuestion.type === 'choice' || currentQuestion.type === 'identify') && selectedOption === null) || (currentQuestion.type === 'truefalse' && selectedOption === null)}
                          className="flex-1 btn-egypt bg-gradient-to-r from-amber-600 to-amber-700 disabled:from-gray-300 disabled:to-gray-400 disabled:shadow-none text-white font-black text-2xl py-5 rounded-3xl shadow-xl shadow-amber-900/40 uppercase tracking-tighter"
                        >
                          Vasta ğ“±
                        </button>
                      </div>
                    </>
                  )}

                  {showResult && (
                    <div className={`p-8 rounded-[40px] animate-in zoom-in duration-300 ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white shadow-2xl shadow-red-500/50'}`}>
                      <div className="flex items-center gap-6 mb-6">
                        <div className="w-20 h-20 bg-white/20 rounded-3xl flex items-center justify-center text-6xl drop-shadow-xl animate-bounce">
                          {isCorrect ? 'âœ¨' : 'ğ“¼'}
                        </div>
                        <div>
                          <h3 className="text-3xl font-black uppercase tracking-tighter">
                            {isCorrect ? 'HIILGAV!' : 'OI-OI...'}
                          </h3>
                          <p className="text-white/80 font-bold italic">{isCorrect ? playerName : 'See kord ei tÃ¤ppi...'}</p>
                        </div>
                      </div>

                      {!isCorrect && (
                        <div className="bg-white/10 rounded-3xl p-6 mb-6 border border-white/20">
                          <div className="text-xs font-black uppercase tracking-widest opacity-70 mb-2">Ã•ige vastus oli</div>
                          <div className="text-2xl font-black">
                            {currentQuestion.type === 'truefalse' ? (currentQuestion.correct ? 'TÃµene' : 'VÃ¤Ã¤r') :
                              currentQuestion.type === 'choice' || currentQuestion.type === 'identify' ? currentQuestion.options[currentQuestion.correct] :
                                currentQuestion.answer?.[0]}
                          </div>
                          {currentQuestion.explanation && <p className="mt-4 text-sm font-medium opacity-90 leading-relaxed italic">"{currentQuestion.explanation}"</p>}
                        </div>
                      )}

                      {currentQuestion.fact && (
                        <div className="bg-black/10 rounded-3xl p-6 border border-white/10 mb-8">
                          <div className="flex gap-4 items-start">
                            <span className="text-3xl">ğŸ“œ</span>
                            <div className="text-sm font-black leading-relaxed">{currentQuestion.fact}</div>
                          </div>
                        </div>
                      )}

                      <button onClick={nextQuestion} className="w-full bg-white text-black font-black py-6 rounded-3xl text-2xl shadow-2xl transition-transform hover:scale-[1.02] active:scale-95 uppercase tracking-tighter">
                        {fallingBack ? 'ğŸ˜µ KUKUD TAGASI' : 'JÃ„TKA TEEKONDA ğ“…›'}
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (screen === 'victory') {
        return (
          <div className="min-h-screen bg-gradient-to-b from-amber-600 via-amber-400 to-amber-700 flex items-center justify-center p-4 relative overflow-hidden">
            <div className="bg-sand absolute inset-0 pointer-events-none opacity-20"></div>
            <div className="text-center max-w-2xl relative z-10">
              <div className="text-9xl mb-8 animate-float drop-shadow-2xl">ğŸ‘‘</div>
              <h1 className="text-7xl font-black text-amber-950 mb-2 uppercase tracking-tighter">SUUR VÃ•IT!</h1>
              <p className="text-3xl text-amber-900 font-bold mb-10 tracking-widest italic">{playerName}, oled Niiluse valitseja!</p>

              <div className="glass rounded-[40px] p-10 mb-10 shadow-[0_40px_100px_-20px_rgba(0,0,0,0.4)] border-2 border-white/30 backdrop-blur-xl">
                <div className="text-6xl font-black text-amber-950 mb-8 border-b-2 border-amber-950/10 pb-6 tracking-tighter">{score}<span className="text-xl uppercase ml-2 opacity-50">punkti</span></div>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                  <div className="bg-amber-950/5 p-4 rounded-3xl border border-amber-950/5">
                    <div className="text-3xl mb-1">ğŸ”¥</div>
                    <div className="text-[10px] font-black uppercase tracking-widest opacity-60 text-amber-900 mb-1">Parim</div>
                    <div className="text-2xl font-black text-amber-950">{bestStreak}</div>
                  </div>
                  <div className="bg-amber-950/5 p-4 rounded-3xl border border-amber-950/5">
                    <div className="text-3xl mb-1">ğŸ’</div>
                    <div className="text-[10px] font-black uppercase tracking-widest opacity-60 text-amber-900 mb-1">Aarded</div>
                    <div className="text-2xl font-black text-amber-950">{collectedTreasures.length}</div>
                  </div>
                  <div className="bg-amber-950/5 p-4 rounded-3xl border border-amber-950/5">
                    <div className="text-3xl mb-1">ğŸ“š</div>
                    <div className="text-[10px] font-black uppercase tracking-widest opacity-60 text-amber-900 mb-1">Faktid</div>
                    <div className="text-2xl font-black text-amber-950">{factCards.length}</div>
                  </div>
                  <div className="bg-amber-950/5 p-4 rounded-3xl border border-amber-950/5">
                    <div className="text-3xl mb-1">ğŸ†</div>
                    <div className="text-[10px] font-black uppercase tracking-widest opacity-60 text-amber-900 mb-1">Tiitlid</div>
                    <div className="text-2xl font-black text-amber-950">{unlockedAchievements.length}</div>
                  </div>
                </div>
              </div>

              <div className="text-6xl mb-10 flex justify-center gap-6 opacity-80 animate-pulse">
                <span>ğŸ›ï¸</span><span>ğŸª</span><span>ğŸ”º</span><span>ğŸ‘‘</span><span>ğŸ—¿</span>
              </div>

              <button onClick={() => { playSound('click'); setScreen('start'); }} className="btn-egypt bg-amber-950 text-white font-black py-6 px-16 rounded-3xl text-3xl shadow-2xl hover:scale-105 active:scale-95 transition-all uppercase tracking-tighter">
                MÃ¤ngi uuesti ğ“±
              </button>
            </div>
          </div>
        );
      }

      return null;
    };

    ReactDOM.render(<NiiluseTeekond />, document.getElementById('root'));

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => console.log('SW registered:', registration))
          .catch(error => console.log('SW registration failed:', error));
      });
    }
  </script>
</body>

</html>